<html>
    <head>
        <title>App 2</title>
        <script type="module" src="/src/fdc3Stub/main.ts"></script>
        <script>
                document.addEventListener("fdc3Ready", () => {
                    console.log("fdc3Ready - App 2");

                    fdc3.addContextListener("fdc3.instrument", (context) => {
                        const contextField = document.getElementById("context");
                        contextField.textContent = JSON.stringify(context);
                    })
                    const button = document.getElementById("testBroadcast");
                    if (button){
                        button.addEventListener("click", () => {
                            fdc3.broadcast({
                                type:"fdc3.instrument",
                                id: {
                                    ticker: "IBM"
                                }
                            });
                        });
                    }

                    const joinChannelButton = document.getElementById("testJoinChannel");
                    if (joinChannelButton){
                        joinChannelButton.addEventListener("click", async () => {
                            await fdc3.joinChannel('red');
                            const channel = await fdc3.getCurrentChannel();
                            console.log("***channel", channel);
                            fdc3.broadcast({
                                type:"fdc3.instrument",
                                id: {
                                    ticker: "AAPL"
                                }
                            });
                        });
                    }
                });
            
            </script>
    </head>
    <body>
        <h1>App 2</h1>
        <p>This is a demo of a portal app</p>
        <button id="testBroadcast">broadcast</button>
        <button id="testJoinChannel">join channel</button>
        <div id="context" style="height:300px;width:300px"></div>
    </body>
</html>